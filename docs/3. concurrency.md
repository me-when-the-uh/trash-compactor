# Concurrency and Resource Management

Trash-compactor adapts its execution strategy to the host machine's hardware capabilities. It distinguishes between lightweight compression algorithms (XPRESS) and heavy ones (LZX), allocating resources to maximize throughput without overwhelming the system.

## Worker Sizing

The application queries the CPU topology to determine the optimal number of concurrent workers.

For XPRESS algorithms (4K, 8K, 16K), which are relatively fast and low-overhead, the system defaults to using one worker per logical core, leaving one core free to maintain system responsiveness.

LZX compression is significantly more CPU-intensive. The worker count for LZX is more conservative, typically limited to two concurrent threads on capable machines, or a single thread on systems with fewer than four cores. This prevents the compression process from monopolizing the CPU and causing system stutter.

## HDD Safeguards

When the target drive is detected as a traditional spinning hard disk (HDD), it's recommended to a single-worker mode with the `-s` flag. Concurrent compression on rotational media causes excessive disk thrashing, which degrades performance and increases file fragmentation. In this mode, all operations are serialized regardless of the CPU's capabilities in hopes to reduce disk seeking and improve sequential read/write speeds, as well as reduce file fragmentation - but file fragmentation will not be eliminated outright.

## Execution Model

The `execute_compression_plan` function in `src/compression/compression_executor.py` manages the thread pools. It groups files by their assigned algorithm and processes these groups sequentially. Within each algorithm group, files are processed in parallel using a `ThreadPoolExecutor`.

This design ensures that the heavy LZX compression phase does not run simultaneously with the high-throughput XPRESS phases, allowing for better thermal management and predictable system load.
